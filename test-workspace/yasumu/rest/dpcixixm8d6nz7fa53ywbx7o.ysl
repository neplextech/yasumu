@rest

metadata {
  name: "Echo"
  method: "GET"
  id: "dpcixixm8d6nz7fa53ywbx7o"
  groupId: null
}

request {
  url: "{{API_URL}}/:path"
  headers: [
    {
      key: "X-Custom-Header"
      value: "1234HELLO"
      enabled: true
    },
    {
      key: "Authorization"
      value: "Bearer BearerToken123432245325"
      enabled: true
    },
  ]
  parameters: [
    {
      key: "path"
      value: "432432"
      enabled: true
    },
  ]
  searchParameters: [
    {
      key: "userId"
      value: "{{USER_ID}}"
      enabled: true
    },
  ]
  body: null
}

dependencies []

script {
  let reqId
    
    export async function onRequest(req) {
      reqId = Yasumu.cuid()
      const userId = req.env.getSecret('USER_ID')
      req.headers.set('x-current-user-id', userId ?? 'NONE')
      req.headers.set('x-request-id', reqId)
    }
    
    export async function onResponse(req, res) {
      res.env.setVariable('SOURCE', res.json().meta.source)
      res.env.setVariable('TIMESTAMP', res.json().meta.timestamp)
    
      await Yasumu.ui.showNotification({
        title: `Info for request ${reqId}`,
        message: 'Your request has been processed!',
        variant: 'info',
      });
    }
}

