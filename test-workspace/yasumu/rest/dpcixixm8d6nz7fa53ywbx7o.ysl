@rest

metadata {
  name: "Echo server"
  method: "POST"
  id: "dpcixixm8d6nz7fa53ywbx7o"
  groupId: null
}

request {
  url: "{{API_URL}}/:path"
  headers: [
    {
      key: "X-Custom-Header"
      value: "1234HELLO"
      enabled: true
    },
    {
      key: "Authorization"
      value: "Bearer BearerToken123432245325"
      enabled: true
    },
  ]
  parameters: [
    {
      key: "path"
      value: "432432"
      enabled: true
    },
  ]
  searchParameters: [
    {
      key: "userId"
      value: "{{USER_ID}}"
      enabled: true
    },
  ]
  body: {
    type: "json"
    content: "[\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  },\r\n  {\r\n    \"url\": \"http://localhost:52645/\",\r\n    \"path\": \"/\",\r\n    \"method\": \"GET\",\r\n    \"headers\": {\r\n      \"accept\": \"*/*\",\r\n      \"authorization\": \"Bearer d60bc95f0b2292871fcb8623c4f09655\",\r\n      \"host\": \"localhost:52645\",\r\n      \"origin\": \"http://tauri.localhost\",\r\n      \"user-agent\": \"Yasumu/1.0\"\r\n    },\r\n    \"args\": {},\r\n    \"cookies\": {},\r\n    \"body\": \"\",\r\n    \"json\": null,\r\n    \"form\": null,\r\n    \"files\": {},\r\n    \"data\": \"\",\r\n    \"meta\": {\r\n      \"timestamp\": \"2026-01-01T15:16:33.585Z\",\r\n      \"source\": \"tanxium-echo-server\"\r\n    }\r\n  }\r\n]"
  }
}

dependencies []

script {
  let reqId: string
  
  export async function onRequest(req: YasumuRequest) {
    reqId = Yasumu.cuid()
    const userId = req.env.getSecret('USER_ID')
    req.headers.set('x-current-user-id', userId ?? 'NONE')
    req.headers.set('x-request-id', reqId)
  }
  
  export async function onResponse(req: YasumuRequest, res: YasumuResponse) {
    res.env.setVariable('SOURCE', res.json<any>().meta.source)
    res.env.setVariable('TIMESTAMP', res.json<any>().meta.timestamp)
  
    await Yasumu.ui.showNotification({
      title: `Info for request ${reqId}`,
      message: 'Your request has been processed!',
      variant: 'info',
    });
  }
}

